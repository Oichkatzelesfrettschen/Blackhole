{
  "version": 6,
  "cmakeMinimumRequired": {
    "major": 3,
    "minor": 21,
    "patch": 0
  },
  "configurePresets": [
    {
      "name": "base",
      "hidden": true,
      "cacheVariables": {
        "CMAKE_EXPORT_COMPILE_COMMANDS": "ON"
      }
    },
    {
      "name": "release",
      "displayName": "Release",
      "description": "Optimized release build",
      "inherits": "base",
      "binaryDir": "${sourceDir}/build/Release",
      "installDir": "${sourceDir}/install/Release",
      "cacheVariables": {
        "CMAKE_BUILD_TYPE": "Release",
        "CMAKE_TOOLCHAIN_FILE": "${sourceDir}/build/Release/generators/conan_toolchain.cmake",
        "ENABLE_HARDENING": "ON",
        "ENABLE_LINKER_HARDENING": "ON",
        "WARNING_LEVEL": "5"
      }
    },
    {
      "name": "debug",
      "displayName": "Debug",
      "description": "Debug build with symbols",
      "inherits": "base",
      "binaryDir": "${sourceDir}/build/Debug",
      "installDir": "${sourceDir}/install/Debug",
      "cacheVariables": {
        "CMAKE_BUILD_TYPE": "Debug",
        "CMAKE_TOOLCHAIN_FILE": "${sourceDir}/build/Debug/generators/conan_toolchain.cmake",
        "ENABLE_GL_DEBUG": "ON",
        "WARNING_LEVEL": "5"
      }
    },
    {
      "name": "asan",
      "displayName": "AddressSanitizer",
      "description": "Debug build with ASan + UBSan",
      "inherits": "debug",
      "cacheVariables": {
        "ENABLE_ASAN": "ON",
        "ENABLE_UBSAN": "ON",
        "ENABLE_HARDENING": "OFF"
      }
    },
    {
      "name": "tsan",
      "displayName": "ThreadSanitizer",
      "description": "Debug build with TSan",
      "inherits": "debug",
      "cacheVariables": {
        "ENABLE_TSAN": "ON",
        "ENABLE_HARDENING": "OFF"
      }
    },
    {
      "name": "analyze",
      "displayName": "Static Analysis",
      "description": "Build with clang-tidy and cppcheck",
      "inherits": "debug",
      "cacheVariables": {
        "ENABLE_CLANG_TIDY": "OFF",
        "ENABLE_CPPCHECK": "ON"
      }
    },
    {
      "name": "analyze-full",
      "displayName": "Full Static Analysis",
      "description": "Build with all analysis tools",
      "inherits": "analyze",
      "cacheVariables": {
        "ENABLE_IWYU": "ON",
        "ENABLE_GCC_ANALYZER": "ON"
      }
    },
    {
      "name": "riced",
      "displayName": "Riced Debug",
      "description": "Max warnings + Werror + analysis + Tracy + profiling flags",
      "inherits": "debug",
      "binaryDir": "${sourceDir}/build/Riced/Debug",
      "installDir": "${sourceDir}/install/Riced/Debug",
      "cacheVariables": {
        "CMAKE_BUILD_TYPE": "Debug",
        "CMAKE_TOOLCHAIN_FILE": "${sourceDir}/build/Riced/Debug/generators/conan_toolchain.cmake",
        "ENABLE_WERROR": "ON",
        "WARNING_LEVEL": "5",
        "ENABLE_CLANG_TIDY": "OFF",
        "ENABLE_CPPCHECK": "ON",
        "ENABLE_IWYU": "OFF",
        "ENABLE_GCC_ANALYZER": "OFF",
        "ENABLE_TRACY": "ON",
        "ENABLE_PROFILING": "ON",
        "ENABLE_SHADER_VALIDATION": "ON"
      }
    },
    {
      "name": "riced-asan",
      "displayName": "Riced ASan/UBSan",
      "description": "Riced debug build with ASan + UBSan",
      "inherits": "asan",
      "binaryDir": "${sourceDir}/build/RicedAsan/Debug",
      "installDir": "${sourceDir}/install/RicedAsan/Debug",
      "cacheVariables": {
        "CMAKE_BUILD_TYPE": "Debug",
        "CMAKE_TOOLCHAIN_FILE": "${sourceDir}/build/RicedAsan/Debug/generators/conan_toolchain.cmake",
        "ENABLE_WERROR": "ON",
        "WARNING_LEVEL": "5",
        "ENABLE_CLANG_TIDY": "OFF",
        "ENABLE_CPPCHECK": "ON",
        "ENABLE_TRACY": "ON",
        "ENABLE_PROFILING": "ON",
        "ENABLE_SHADER_VALIDATION": "ON"
      }
    },
    {
      "name": "riced-tsan",
      "displayName": "Riced TSan",
      "description": "Riced debug build with TSan",
      "inherits": "tsan",
      "binaryDir": "${sourceDir}/build/RicedTsan/Debug",
      "installDir": "${sourceDir}/install/RicedTsan/Debug",
      "cacheVariables": {
        "CMAKE_BUILD_TYPE": "Debug",
        "CMAKE_TOOLCHAIN_FILE": "${sourceDir}/build/RicedTsan/Debug/generators/conan_toolchain.cmake",
        "ENABLE_WERROR": "ON",
        "WARNING_LEVEL": "5",
        "ENABLE_CLANG_TIDY": "ON",
        "ENABLE_CPPCHECK": "ON",
        "ENABLE_TRACY": "OFF",
        "ENABLE_PROFILING": "ON",
        "ENABLE_SHADER_VALIDATION": "ON"
      }
    },
    {
      "name": "coverage",
      "displayName": "Coverage",
      "description": "Debug build with coverage instrumentation",
      "inherits": "debug",
      "binaryDir": "${sourceDir}/build/Coverage/Debug",
      "installDir": "${sourceDir}/install/Coverage/Debug",
      "cacheVariables": {
        "CMAKE_BUILD_TYPE": "Debug",
        "CMAKE_TOOLCHAIN_FILE": "${sourceDir}/build/Coverage/Debug/generators/conan_toolchain.cmake",
        "ENABLE_COVERAGE": "ON",
        "ENABLE_WERROR": "ON",
        "WARNING_LEVEL": "5",
        "ENABLE_PROFILING": "ON",
        "ENABLE_SHADER_VALIDATION": "ON"
      }
    },
    {
      "name": "profile",
      "displayName": "Profiling",
      "description": "RelWithDebInfo build with Tracy + gprof",
      "inherits": "base",
      "binaryDir": "${sourceDir}/build/Profile/RelWithDebInfo",
      "installDir": "${sourceDir}/install/Profile/RelWithDebInfo",
      "cacheVariables": {
        "CMAKE_BUILD_TYPE": "RelWithDebInfo",
        "CMAKE_TOOLCHAIN_FILE": "${sourceDir}/build/Profile/RelWithDebInfo/generators/conan_toolchain.cmake",
        "ENABLE_TRACY": "ON",
        "ENABLE_PROFILING": "ON",
        "ENABLE_GPROF": "ON",
        "ENABLE_WERROR": "ON",
        "WARNING_LEVEL": "5"
      }
    },
    {
      "name": "fuzz",
      "displayName": "Fuzzing",
      "description": "Build fuzzing targets with libFuzzer",
      "inherits": "base",
      "cacheVariables": {
        "CMAKE_BUILD_TYPE": "Release",
        "ENABLE_FUZZING": "ON",
        "CMAKE_CXX_COMPILER": "clang++"
      }
    },
    {
      "name": "ci",
      "displayName": "CI Build",
      "description": "Continuous integration build",
      "inherits": "release",
      "cacheVariables": {
        "ENABLE_CLANG_TIDY": "ON",
        "ENABLE_CPPCHECK": "ON",
        "ENABLE_SHADER_VALIDATION": "ON"
      }
    }
  ],
  "buildPresets": [
    {
      "name": "release",
      "configurePreset": "release"
    },
    {
      "name": "debug",
      "configurePreset": "debug"
    },
    {
      "name": "asan",
      "configurePreset": "asan"
    },
    {
      "name": "tsan",
      "configurePreset": "tsan"
    },
    {
      "name": "riced",
      "configurePreset": "riced"
    },
    {
      "name": "riced-asan",
      "configurePreset": "riced-asan"
    },
    {
      "name": "riced-tsan",
      "configurePreset": "riced-tsan"
    },
    {
      "name": "coverage",
      "configurePreset": "coverage"
    },
    {
      "name": "profile",
      "configurePreset": "profile"
    },
    {
      "name": "analyze",
      "configurePreset": "analyze"
    },
    {
      "name": "fuzz",
      "configurePreset": "fuzz"
    },
    {
      "name": "ci",
      "configurePreset": "ci"
    }
  ],
  "testPresets": [
    {
      "name": "default",
      "configurePreset": "debug",
      "output": {
        "outputOnFailure": true
      }
    },
    {
      "name": "riced",
      "configurePreset": "riced",
      "output": {
        "outputOnFailure": true
      }
    },
    {
      "name": "asan",
      "configurePreset": "asan",
      "output": {
        "outputOnFailure": true
      },
      "environment": {
        "ASAN_OPTIONS": "detect_leaks=1:abort_on_error=1:halt_on_error=1",
        "UBSAN_OPTIONS": "print_stacktrace=1:halt_on_error=1"
      }
    },
    {
      "name": "riced-asan",
      "configurePreset": "riced-asan",
      "output": {
        "outputOnFailure": true
      },
      "environment": {
        "ASAN_OPTIONS": "detect_leaks=1:abort_on_error=1:halt_on_error=1",
        "UBSAN_OPTIONS": "print_stacktrace=1:halt_on_error=1"
      }
    },
    {
      "name": "tsan",
      "configurePreset": "tsan",
      "output": {
        "outputOnFailure": true
      },
      "environment": {
        "TSAN_OPTIONS": "halt_on_error=1:second_deadlock_stack=1"
      }
    },
    {
      "name": "riced-tsan",
      "configurePreset": "riced-tsan",
      "output": {
        "outputOnFailure": true
      },
      "environment": {
        "TSAN_OPTIONS": "halt_on_error=1:second_deadlock_stack=1"
      }
    },
    {
      "name": "coverage",
      "configurePreset": "coverage",
      "output": {
        "outputOnFailure": true
      }
    }
  ],
  "workflowPresets": [
    {
      "name": "ci",
      "displayName": "CI Workflow",
      "description": "Full CI pipeline: analyze, build, test",
      "steps": [
        {
          "type": "configure",
          "name": "ci"
        },
        {
          "type": "build",
          "name": "ci"
        }
      ]
    },
    {
      "name": "sanitize",
      "displayName": "Sanitizer Workflow",
      "description": "Run with ASan and TSan",
      "steps": [
        {
          "type": "configure",
          "name": "asan"
        },
        {
          "type": "build",
          "name": "asan"
        },
        {
          "type": "test",
          "name": "asan"
        }
      ]
    }
  ]
}
